<div class='nested-fields'>
  <%= f.input :habitatId, :as => :hidden%>
  <%= f.input :especieId, :as => :hidden%>
  <%= f.input :tipoAmbiente, as: :radio_buttons, :collection => Fichas::Habitat::TIPOS_HABITAT, item_wrapper_class: 'radio-inline', input_html: { onclick: 'showOrHideAmbienteDesarrolloEspecie($(this))' } %>
  <hr>

  <fieldset class="apartados">
    <legend class="text-primary"> Ecorregiones </legend>
    <%= f.association :ecorregion,
      label_method: :descripcion,
      value_method: :ecorregionId,
      :as => :select,
      input_html: {
          class: 'form-control selectpicker',
          multiple: true,
          'data-live-search': 'true',
          'title': t('general.seleccionar_opciones'),
          'data-selected-text-format': 'count > 3'
      }
    %>

    <%=
      ambi_titulo = "Información adicional"
      ambi_pregunta = Fichas::Observacionescarac::PREGUNTAS[:info_ecorregiones]
      ambi_id_div = 'info_ecorregiones'
      link_to_add_association('<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Agregar información adicional'.html_safe, f_taxon, :info_ecorregiones, partial: 'fichas/taxa/caracteristicas_especie/observaciones_especie_x', render_options: {locals: { titulo: ambi_titulo, id_pregunta: ambi_pregunta}}, :class => 'btn btn-info btn-sm', role: 'tab', "data-toggle" => 'tab', "aria-controls" => ambi_id_div, 'data-association-insertion-node' => '#' + ambi_id_div, 'data-association-insertion-method' => 'append', href: '#' + ambi_id_div)
    %>
    <div id="<%= ambi_id_div %>">
      <%= f_taxon.simple_fields_for :info_ecorregiones do |info| %>
        <%= render partial: 'fichas/taxa/caracteristicas_especie/observaciones_especie_x', locals: {f: info, titulo: ambi_titulo, id_pregunta: ambi_pregunta} %>
      <% end %>
    </div>

  </fieldset>

  <fieldset class="apartados">
    <legend class="text-primary"> Ecosistemas </legend>
    <%= f.association :ecosistema,
      label_method: :tipoecosistema,
      value_method: :ecosistemaid,
      :as => :select,
      input_html: {
          class: 'form-control selectpicker',
          multiple: true,
          'data-live-search': 'true',
          'title': t('general.seleccionar_opciones'),
          'data-selected-text-format': 'count > 3'
      }
    %>
  </fieldset>

  <div id="ambiente-solo-terrestre">
    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.t_vegetacion') %></h3>

    <% c_vegetacion = Fichas::Vegetacion.all.group_by(&:descripcionVegetacion) %>
    <%= f.association :vegetacion,
          :as => :grouped_select,
          collection: c_vegetacion,
          :group_method => :last,
          group_label_method: :first,
          label_method: :descripcionSubVegetacion,
          value_method: :vegetacionId,
          input_html: {
              :multiple => true,
              class: 'form-control selectpicker',
              'data-live-search': 'true',
              'title': t('general.seleccionar_opciones'),
              'data-selected-text-format': 'count > 3'
          }
    %>
    <%= f.input :tipoVegetacion %>


    <%= f.input :habitatAgropecuario, as: :radio_buttons, :collection => [ ['Sí', 'Sí'], ['No', 'no'] ], item_wrapper_class: 'radio-inline'  %>
    <%= f.input :zonaUrbana, as: :radio_buttons, :collection => [ ['Sí', 'Sí'], ['No', 'no'] ], item_wrapper_class: 'radio-inline'  %>
    <%= f.input :VegetacionSecundaria, as: :radio_buttons, :collection => [ ['Sí', 'Sí'], ['No', 'no'] ], item_wrapper_class: 'radio-inline', input_html: { onclick: 'showOrHide(this, "vegetacion-secundaria")', name: 'opcion-vegetacion-secundaria'} %>
    <div id="vegetacion-secundaria">

    </div>

    <div class="apartadoFicha ficha-Prioritaria ficha-CITES ficha-Silvestre">
      <%=
        ambi_titulo = "d) Mencionar las especies asociadas"
        ambi_pregunta = Fichas::Observacionescarac::PREGUNTAS[:ambi_especies_asociadas]
        ambi_id_div = 'info_ambi_especies_asociadas'
        link_to_add_association('<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Agregar especies asociadas'.html_safe, f_taxon, :ambi_especies_asociadas, partial: 'fichas/taxa/caracteristicas_especie/observaciones_especie_x', render_options: {locals: { titulo: ambi_titulo, id_pregunta: ambi_pregunta}}, :class => 'btn btn-info btn-sm', role: 'tab', "data-toggle" => 'tab', "aria-controls" => ambi_id_div, 'data-association-insertion-node' => '#' + ambi_id_div, 'data-association-insertion-method' => 'append', href: '#' + ambi_id_div)
      %>
      <div id="<%= ambi_id_div %>">
        <%= f_taxon.simple_fields_for :ambi_especies_asociadas do |info| %>
          <%= render partial: 'fichas/taxa/caracteristicas_especie/observaciones_especie_x', locals: {f: info, titulo: ambi_titulo, id_pregunta: ambi_pregunta} %>
        <% end %>
      </div>
    </div>

    <div class="apartadoFicha ficha-Invasora">
      <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.vegetacion_mundial') %></h3>


      <%=
        ambi_titulo = "Información adicional"
        ambi_pregunta = Fichas::Observacionescarac::PREGUNTAS[:ambi_vegetacion_esp_mundo]
        ambi_id_div = 'info_ambi_vegetacion_esp_mundo'
        link_to_add_association('<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Agregar especies asociadas'.html_safe, f_taxon, :ambi_vegetacion_esp_mundo, partial: 'fichas/taxa/caracteristicas_especie/observaciones_especie_x', render_options: {locals: { titulo: ambi_titulo, id_pregunta: ambi_pregunta}}, :class => 'btn btn-info btn-sm', role: 'tab', "data-toggle" => 'tab', "aria-controls" => ambi_id_div, 'data-association-insertion-node' => '#' + ambi_id_div, 'data-association-insertion-method' => 'append', href: '#' + ambi_id_div)
      %>
      <div id="<%= ambi_id_div %>">
        <%= f_taxon.simple_fields_for :ambi_vegetacion_esp_mundo do |info| %>
          <%= render partial: 'fichas/taxa/caracteristicas_especie/observaciones_especie_x', locals: {f: info, titulo: ambi_titulo, id_pregunta: ambi_pregunta} %>
        <% end %>
      </div>

    </div>

    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.int_altitudinal') %></h3>
    <%= f.input :intervaloaltitudinalinicial, item_wrapper_class: 'radio-inline' %>
    <%= f.input :intervaloaltitudinalfinal, item_wrapper_class: 'radio-inline' %>
    <%= f.input :infoAddintervaloaltitudinal %>

    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.clima') %></h3>
    <% c_clima = Fichas::Cat_Preguntas.where(idpregunta: Fichas::Caracteristicasespecie::OPCIONES[:clima]).group_by(&:descn1) %>
    <%= f_taxon.association :t_clima,
                      :as => :grouped_select,
                      collection: c_clima,
                      :group_method => :last,
                      group_label_method: :first,
                      label_method: :descn2,
                      value_method: :idopcion,
                      input_html: {
                          :multiple => true,
                          class: 'form-control selectpicker',
                          'data-live-search': 'true',
                          'title': t('general.seleccionar_opciones'),
                          'data-selected-text-format': 'count > 3'
                      }
    %>
    <%= f.input :climaAdicional %>

    <div class="apartadoFicha ficha-Invasora">

      <%=
        ambi_titulo = "Información adicional"
        ambi_pregunta = Fichas::Observacionescarac::PREGUNTAS[:ambi_info_clima_exotico]
        ambi_id_div = 'info_ambi_info_clima_exotico'
        link_to_add_association('<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Agregar información adicional'.html_safe, f_taxon, :ambi_info_clima_exotico, partial: 'fichas/taxa/caracteristicas_especie/observaciones_especie_x', render_options: {locals: { titulo: ambi_titulo, id_pregunta: ambi_pregunta}}, :class => 'btn btn-info btn-sm', role: 'tab', "data-toggle" => 'tab', "aria-controls" => ambi_id_div, 'data-association-insertion-node' => '#' + ambi_id_div, 'data-association-insertion-method' => 'append', href: '#' + ambi_id_div)
      %>
      <div id="<%= ambi_id_div %>">
        <%= f_taxon.simple_fields_for :ambi_info_clima_exotico do |info| %>
          <%= render partial: 'fichas/taxa/caracteristicas_especie/observaciones_especie_x', locals: {f: info, titulo: ambi_titulo, id_pregunta: ambi_pregunta} %>
        <% end %>
      </div>
    </div>

    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.r_temperatura') %></h3>
    <%= f.input :temperaturainicial %>
    <%= f.input :temperaturafinal %>
    <%= f.input :infoaddtemperatura %>

    <div class="apartadoFicha ficha-Invasora">
      <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.rango_temp_exo') %></h3>
      <%= f.input :temperaturainicialexo%>
      <%= f.input :temperaturafinalexo %>
      <%= f.input :infoaddtemperaturaexo %>
    </div>

    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.r_precipitacion') %></h3>
    <%= f.input :precipitacioninicial %>
    <%= f.input :precipitacionfinal %>
    <%= f.input :infoaddprecipitacion %>

    <div class="apartadoFicha ficha-Invasora">
      <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.rango_hum_exo') %></h3>
      <%= f.input :precipitacioninicialexo %>
      <%= f.input :precipitacionfinalexo %>
      <%= f.input :infoaddprecipitacionexo %>
    </div>

    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.humedad') %></h3>
    <%= f.input :humedadinicial %>
    <%= f.input :humedadfinal %>
    <%= f.input :infoaddhumedad %>

    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.tipo_suelo') %></h3>

    <%= f.input :descripcionSuelo %>

    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.geoforma') %></h3>
    <%= #select_multiple_nivel_1(f, :t_geoforma, Fichas::Caracteristicasespecie::OPCIONES[:geoforma])
    %>

    <%= f.input :descripcionGeoforma %>
  </div>
  <%
    # Hasta aquí llega la parte terrestre
  %>

  <%
    # Aquí inicia la parte marina
  %>
  <div id="ambiente-solo-marino">
    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.tipo_habitat') %></h3>


    <h4 class="titulo_sub_subseccion"><%= t('secciones.s_ambiente.ecosistemas') %></h4>

    <%= f.input :biotipos %>

    <%= f.association :vegetacion_acuatica,
                      :as => :grouped_select,
                      collection: Fichas::Vegetacionacuatica.all.group_by(&:vegetacion),
                      :group_method => :last,
                      group_label_method: :first,
                      label_method: :subVegetacion,
                      value_method: :vegetacionAcuaticaid,
                      input_html: {
                          :multiple => true,
                          class: 'form-control selectpicker',
                          'data-live-search': 'true',
                          'title': t('general.seleccionar_opciones'),
                          'data-selected-text-format': 'count > 3'
                      }
    %>

    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.caracteristicas_agua') %></h3>
    <h4 class="titulo_sub_subseccion"><%= t('secciones.s_ambiente.salinidad') %></h4>
    <%= f.input :salinidadinicial %>
    <%= f.input :salinidadfinal %>
    <%= f.input :unidadsalinidad, collection: Fichas::Habitat::UNIDAD_SALINIDAD, :as => :select, input_html: {class: 'form-control selectpicker', 'title': t('general.seleccionar_opcion')} %>
    <h4 class="titulo_sub_subseccion"><%= t('secciones.s_ambiente.oxigeno') %></h4>
    <%= f.input :oxigenoinicial %>
    <%= f.input :oxigenofinal %>
    <h4 class="titulo_sub_subseccion"><%= t('secciones.s_ambiente.ph') %></h4>
    <%= f.input :phinicial %>
    <%= f.input :phfinal %>
    <h4 class="titulo_sub_subseccion"><%= t('secciones.s_ambiente.temperatura') %></h4>
    <%= f.input :temeperaturainicial %>
    <%= f.input :temeperaturafinal %>
    <%= f.input :corrientes %>
    <%= f.input :infoaddcaracagua %>
    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.int_altitudinal') %></h3>
    <%= f.input :intervaloaltitudinalacuainicial %>
    <%= f.input :intervaloaltitudinalacuafinal %>
    <%= f.input :infoAddintervaloaltitudinalacua %>
    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.int_batimetrico') %></h3>
    <%= f.input :interbatimetricoinicial %>
    <%= f.input :interbatimetricofinal %>
    <%= f.input :infoaddinterbatimetrico %>
    <h3 class="titulo_subseccion"><%= t('secciones.s_ambiente.amp_mareas') %></h3>
    <%= f.input :amplitudmareasinicial %>
    <%= f.input :amplitudmareasfinal %>
    <%= f.input :infoaddamplitudmareas %>
  </div>

</div>