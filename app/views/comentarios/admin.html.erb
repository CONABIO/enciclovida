<%= link_to 'Limpiar filtros', admin_path %>

<table class="table table-hover table-striped table-condensed table-bordered">
  <%= form_tag admin_path, method: :get, id: 'filtro_form' do %>
      <thead>
      <tr>
        <th>
          <%= select_tag 'comentario[estatus]', options_for_select(Comentario.options_for_select),
                         id: 'filtro_estatus', prompt: '- - - Estatus - - -' %>

          <a href="#" data-toggle="popover" data-content="Público: Muestra el comentario como una advertencia, en la ficha del taxón" onclick="return false;">
            <i class="glyphicon glyphicon-info-sign"></i>
          </a>
        </th>
        <th>
          <%= select_tag 'comentario[categoria_comentario_id]', grouped_options_for_select(CategoriaComentario.grouped_options),
                         id: 'filtro_categoria_comentario_id', prompt: '- - - Tipo de comentario - - -' %>
        </th>
        <th>Comentario</th>
        <th>
          <%= t :taxon %>
        </th>
        <th>Nombre <br /> correo <br /> fecha <a><i class="glyphicon glyphicon-chevron-up"></i></a></th>
        <th>¿Quién y cuando?
          <a href="#" data-toggle="popover" data-content="El personal de CONABIO que realizó la ultima modificación en el estatus del comentario" onclick="return false;">
            <i class="glyphicon glyphicon-info-sign"></i>
          </a>
        </th>
      </tr>
      </thead>
  <% end %>

  <tbody style="font-size: .85em;">
  <%
     @comentarios.each do |c|
       if c.usuario_id.present?
         if u = c.usuario
           correo = u.email
           nombre = "#{u.nombre} #{u.apellido}"

         else
           correo = c.correo
           nombre = c.nombre
         end
       else
         correo = c.correo
         nombre = c.nombre
       end

       if t = c.especie
         taxon = t.nombre_cientifico
       else
         taxon = "Este #{t(:taxon)} no existe"
       end
  %>

      <tr>
        <td class="text-center">
          <%= select_tag 'comentario[estatus]', options_for_select(Comentario.options_for_select, c.estatus),
                         class: 'comentario_estatus', comentario_id: c.id, especie_id: c.especie_id %>
          <div id="comentario_estatus_div_<%= c.id %>" style="display: none;"></div>
        </td>
        <td>
          <%= select_tag 'comentario[categoria_comentario_id]', grouped_options_for_select(CategoriaComentario.grouped_options, c.categoria_comentario_id),
                         class: 'comentario_categoria_comentario_id', comentario_id: c.id, especie_id: c.especie_id %>
          <div id="comentario_categoria_comentario_id_div_<%= c.id %>" style="display: none;"></div>
        </td>
        <td><%= c.comentario %>
          <p>
            <%= link_to(c.cuantos == 1 ? t('comentario.x_comentario.uno') : t('comentario.x_comentario.varios', cuantos: c.cuantos), '',
                        class: 'historial', comentario_id: c.id, especie_id: c.especie_id) if c.cuantos > 0 %>
            <%= link_to 'Ocultar', '', id: "ocultar_#{c.id}", style: 'display: none;' %>
          </p>
          <div id="historial_<%= c.id %>"></div>
        </td>
        <td><%= link_to taxon, "/especies/#{c.especie_id}", target: :_blank %></td>
        <td><%= nombre %><br /><%= link_to correo, "mailto:#{correo}" %><br /><span title="<%= c.created_at %>"><%= c.created_at.strftime('%d/%m/%y') %></span></td>
        <td>
          <% if u = c.usuario_id2 %>
              <p>
                <%= "#{u.nombre} #{u.apellido}" %>
              </p>
              <%= c.fecha_estatus %>
          <% end %>
        </td>
      </tr>
  <% end %>

  </tbody>
</table>
