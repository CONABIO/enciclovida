<%= javascript_include_tag 'scrolling_basico', 'data-turbolinks-track' => true %>

<script type="text/javascript" charset="utf-8" data-turbolinks-track="true">

    $(document).ready(function() {

        $('#mas_comentarios').scrollPagination({
            per_page: <%= @por_pagina %>, // The number of posts per scroll to be loaded
            page    : <%= @pagina %>, // the actual page
            error   : 'No hay mas comentarios.', // When the user reaches the end this is the message that is
                                        // displayed. You can change this if you want.
            delay   : 500, // When you scroll down the posts will load after a delayed amount of time.
                           // This is mainly for usability concerns. You can alter this as you see fit
            scroll  : true // The main bit, if set to false posts will not load as the user scrolls.
                           // but will still load if the user clicks.
        });
        $('#mas_comentarios').on('click', '.comentarios-correos', function() {
            $(this).children('div.correos, button.btn-correo').toggleClass('hidden');
            id=$(this).children('div.correos')[0].getAttribute('id');
            if ($('#'+id).html().trim().length==0) {
                $('#' + id).load('/comentarios/correoId?id=' + id);
            }
        });
    });

</script>

<%= link_to 'Limpiar filtros', admin_path %>

<% if @totales.present? %>
    <h4>
      <span id="totales" class="badge"><%= @totales %></span> comentarios
    </h4>
<% end %>

<table class="table table-striped table-condensed table-bordered comentarios">
  <%= form_tag admin_path, method: :get, id: 'filtro_form' do %>
      <thead>
      <tr>
        <th colspan="5">
          <span class="label label-warning">Filtrar por: </span>
          <%= select_tag 'comentario[estatus]', options_for_select(Comentario.options_for_select), id: 'filtro_estatus', prompt: 'Estatus', class: 'form-control input-sm' %>
          <a class="btn btn-link" data-toggle="tooltip" data-placement="bottom" title="Público: muestra el comentario como una advertencia, en la ficha del taxón. <br /> Resuelto: se da por solucionado/finalizado el comentario del usuario." type="button" style="white-space: nowrap;"><i class="glyphicon glyphicon-info-sign text-warning"></i></a>
          <%= select_tag 'comentario[categoria_comentario_id]', grouped_options_for_select(@categoria_comentario), id: 'filtro_categoria_comentario_id', prompt: 'Tipo de comentario', class: 'form-control input-sm' %>
        </th>
      </tr>
      <tr>

        <th colspan="2" style="font-size: 1.5em;">Comentarios</th>
        <th>
          <%= t :taxon %> <a class="btn btn-link" href="<%= admin_path %>" id="filtro_nombre_cientifico"><i class="glyphicon glyphicon-sort text-warning"></i></a>
          <%= hidden_field_tag 'comentario[nombre_cientifico]' %>
        </th>
        <th>
          Fecha <a class="btn btn-link" href="<%= admin_path %>" id="filtro_created_at"><i class="glyphicon glyphicon-sort text-warning"></i></a>
          <%= hidden_field_tag 'comentario[created_at]' %>
        </th>
        <th>¿Quién y cuando?
          <button class="btn btn-link" data-toggle="popover" data-content="El personal de CONABIO que realizó la ultima modificación en el estatus del comentario" onclick="return false;"><i class="glyphicon glyphicon-info-sign text-warning"></i></button>
        </th>
      </tr>
      </thead>
  <% end %>

  <tbody style="font-size: .85em;" id="mas_comentarios">
  <%= render :partial => 'comentarios/admin' %>
  </tbody>
</table>
